<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <title>Techshop</title>
    <style>
        .form-control-dark {
            background-color: #343a40; /* Dark background */
            color: #ffffff; /* Light text color */
            border: 1px solid #495057; /* Border color */
        }
        .form-control-dark:focus {
            border-color: blue; /* Blue border on focus */
            background-color: #343a40; /* Maintain dark background */
            color: #ffffff; /* Maintain light text color */
        }
        .white-border {
            border-color: rgb(92, 92, 92); /* White border color */
        }
        .white-right-border {
            border-right: 1px solid rgb(57, 57, 57); /* White right border */
        }
        .alert {
            padding: 15px;
            border-radius: 4px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .delete-product {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .list-group-item:hover .delete-product {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-dark text-white">
    <div class="container mt-4">
        <h2>Techshop Product Management Panel</h2>
        <hr class="border-color white-border">

        <div class="row">
            <div class="col-md-6 border-color white-right-border">
                <h5>Product Creation Menu</h5>

                <form id="productForm">
                    <div class="mb-3">
                        <label for="productName" class="form-label">Product Name:</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    <div class="mb-3">
                        <label for="productPrice" class="form-label">Product Price:</label>
                        <input type="number" class="form-control" id="productPrice" required>
                    </div>
                    <div class="mb-3">
                        <label for="productCategory" class="form-label">Product Category:</label>
                        <input type="text" class="form-control" id="productCategory" required>
                    </div>
                    <div class="mb-3">
                        <label for="productDescription" class="form-label">Product Description:</label>
                        <textarea class="form-control" id="productDescription" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="productStock" class="form-label">Product Stock:</label>
                        <input type="number" class="form-control" id="productStock" required>
                    </div>
                    <div class="mb-3">
                        <label for="productImage" class="form-label">Product Image:</label>
                        <input type="file" class="form-control" id="productImage" accept="image/*" required>
                    </div>
                    <button type="button" id="addProduct" class="btn btn-primary">Add Product</button>
                </form>
            </div>
            <div class="col-md-6">
                <div id="productList" class="">
                    <h5>Product List</h5>
                    <ul id="productDisplay" class="list-group">
                      <li class="list-group-item bg-dark text-white">
                            <img src="https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.farfetch.com%2Fshopping%2Fmen%2Fnike-air-zoom-pegasus-39-blackwhite-sneakers-item-20466692.aspx&psig=AOvVaw0hYat5hyJhz3koXeyfwAdr&ust=1731614192819000&source=images&cd=vfe&opi=89978449&ved=0CBQQjRxqFwoTCLj03diL2okDFQAAAAAdAAAAABAE" alt="Shoes" class="product-img">
                            <strong>Nike Air Zoom Pegasus 39</strong><br>
                            <span>Price: $129.99</span><br>
                            <span>Category: Shoes</span>
                        </li>
                        <li class="list-group-item bg-dark text-white">
                            <img src="https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.walmart.com%2Fip%2FWilson-NFL-The-Duke-Official-Leather-Game-Football%2F134386765&psig=AOvVaw3v6KArQXjER1qlNOtYIdCO&ust=1731614235845000&source=images&cd=vfe&opi=89978449&ved=0CBQQjRxqFwoTCOD7re-L2okDFQAAAAAdAAAAABAE" alt="Football" class="product-img">
                            <strong>Wilson NFL Football</strong><br>
                            <span>Price: $59.99</span><br>
                            <span>Category: Sports Equipment</span>
                        </li>
                        <!-- Repeat for each product -->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        $(document).ready(function() {
            function showNotification(message, isError = false) {
                const notification = $('<div></div>')
                    .addClass('alert')
                    .addClass(isError ? 'alert-danger' : 'alert-success')
                    .text(message)
                    .css({
                        position: 'fixed',
                        top: '20px',
                        right: '20px',
                        zIndex: 1000
                    });
                $('body').append(notification);
                setTimeout(() => notification.remove(), 3000);
            }
        
            async function fetchProducts() {
                try {
                    const response = await fetch('http://localhost:3001/api/products');
                    const products = await response.json();
                    displayProducts(products);
                } catch (error) {
                    showNotification('Error fetching products: ' + error.message, true);
                }
            }
        
            function displayProducts(products) {
                const productDisplay = $('#productDisplay');
                productDisplay.empty();
                
                products.forEach(product => {
                    productDisplay.append(`
                        <li class="list-group-item bg-dark text-white">
                            <strong>${product.name}</strong><br>
                            <span>Description: ${product.description}</span><br>
                            <span>Category: ${product.category}</span><br>
                            <span>Price: $${product.price}</span>
                            <button class="btn btn-danger btn-sm float-end delete-product" data-id="${product._id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </li>
                    `);
                });
            }
        
            async function compressImage(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = (event) => {
                        const img = new Image();
                        img.src = event.target.result;
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            const MAX_WIDTH = 800;
                            const MAX_HEIGHT = 600;
                            let width = img.width;
                            let height = img.height;

                            if (width > height) {
                                if (width > MAX_WIDTH) {
                                    height *= MAX_WIDTH / width;
                                    width = MAX_WIDTH;
                                }
                            } else {
                                if (height > MAX_HEIGHT) {
                                    width *= MAX_HEIGHT / height;
                                    height = MAX_HEIGHT;
                                }
                            }

                            canvas.width = width;
                            canvas.height = height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);
                            const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                            resolve(dataUrl);
                        };
                    };
                });
            }
        
            $('#addProduct').click(async function() {
                const productName = $('#productName').val();
                const productPrice = parseFloat($('#productPrice').val());
                const productCategory = $('#productCategory').val();
                const productDescription = $('#productDescription').val();
                const productStock = parseInt($('#productStock').val());
                const productImageFile = $('#productImage')[0].files[0];
        
                if (!productImageFile) {
                    showNotification('Please select an image file.', true);
                    return;
                }
        
                try {
                    const compressedImage = await compressImage(productImageFile);
        
                    const productData = {
                        name: productName,
                        price: productPrice,
                        category: productCategory,
                        description: productDescription,
                        image: compressedImage,
                        stock: productStock
                    };
        
                    const response = await fetch('http://localhost:3001/api/products', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(productData)
                    });
        
                    if (!response.ok) {
                        throw new Error('Failed to create product');
                    }
        
                    const savedProduct = await response.json();
                    showNotification('Product added successfully!');
                    $('#productForm')[0].reset();
                    fetchProducts();
                } catch (error) {
                    showNotification('Error adding product: ' + error.message, true);
                }
            });
        
            fetchProducts();
        });
        </script>
</body>
</html>
